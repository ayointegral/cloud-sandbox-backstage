# -----------------------------------------------------------------------------
# GCP Kubernetes (GKE) Module - Example tfvars
# -----------------------------------------------------------------------------

project_id  = "my-gcp-project"
region      = "us-central1"
environment = "dev"

# -----------------------------------------------------------------------------
# Network Configuration
# -----------------------------------------------------------------------------

network_self_link             = "projects/my-gcp-project/global/networks/my-vpc"
subnetwork_self_link          = "projects/my-gcp-project/regions/us-central1/subnetworks/gke-subnet"
pods_secondary_range_name     = "pods"
services_secondary_range_name = "services"

# -----------------------------------------------------------------------------
# Cluster Configuration
# -----------------------------------------------------------------------------

cluster_version     = null  # Uses default version based on release channel
release_channel     = "REGULAR"
deletion_protection = true

# -----------------------------------------------------------------------------
# Private Cluster Configuration
# -----------------------------------------------------------------------------

enable_private_cluster      = true
enable_private_endpoint     = false  # Set to true for fully private cluster
master_ipv4_cidr_block      = "172.16.0.0/28"
enable_master_global_access = true

# -----------------------------------------------------------------------------
# Master Authorized Networks
# -----------------------------------------------------------------------------

master_authorized_networks = [
  {
    cidr_block   = "10.0.0.0/8"
    display_name = "Internal VPC"
  },
  {
    cidr_block   = "203.0.113.0/24"
    display_name = "Corporate Office"
  }
]

# -----------------------------------------------------------------------------
# Network Policy
# -----------------------------------------------------------------------------

enable_network_policy = true
datapath_provider     = "ADVANCED_DATAPATH"  # Enables Dataplane V2

# -----------------------------------------------------------------------------
# Workload Identity
# -----------------------------------------------------------------------------

enable_workload_identity = true

# -----------------------------------------------------------------------------
# Logging and Monitoring
# -----------------------------------------------------------------------------

logging_service    = "logging.googleapis.com/kubernetes"
monitoring_service = "monitoring.googleapis.com/kubernetes"
logging_components = ["SYSTEM_COMPONENTS", "WORKLOADS"]
monitoring_components = ["SYSTEM_COMPONENTS"]
enable_managed_prometheus = true

# -----------------------------------------------------------------------------
# Addons Configuration
# -----------------------------------------------------------------------------

enable_http_load_balancing            = true
enable_horizontal_pod_autoscaling     = true
enable_gce_persistent_disk_csi_driver = true
enable_filestore_csi_driver           = false
enable_gcs_fuse_csi_driver            = false
enable_dns_cache                      = true
enable_vertical_pod_autoscaling       = true

# -----------------------------------------------------------------------------
# Node Auto-Provisioning (optional)
# -----------------------------------------------------------------------------

enable_node_auto_provisioning     = false
node_auto_provisioning_cpu_min    = 0
node_auto_provisioning_cpu_max    = 100
node_auto_provisioning_memory_min = 0
node_auto_provisioning_memory_max = 400
node_auto_provisioning_disk_size  = 100
node_auto_provisioning_disk_type  = "pd-standard"

# -----------------------------------------------------------------------------
# Node Pools
# -----------------------------------------------------------------------------

node_pools = [
  {
    name               = "primary"
    machine_type       = "e2-standard-4"
    disk_size_gb       = 100
    disk_type          = "pd-standard"
    image_type         = "COS_CONTAINERD"
    initial_node_count = 1
    min_count          = 1
    max_count          = 5
    enable_autoscaling = true
    location_policy    = "BALANCED"
    preemptible        = false
    spot               = false
    auto_repair        = true
    auto_upgrade       = true
    max_surge          = 1
    max_unavailable    = 0
    upgrade_strategy   = "SURGE"
    labels = {
      workload = "general"
    }
    tags = ["gke-node"]
    taints = []
    enable_secure_boot          = true
    enable_integrity_monitoring = true
    node_locations              = []  # Empty means all zones in region
  },
  {
    name               = "compute"
    machine_type       = "c2-standard-8"
    disk_size_gb       = 200
    disk_type          = "pd-ssd"
    image_type         = "COS_CONTAINERD"
    initial_node_count = 0
    min_count          = 0
    max_count          = 10
    enable_autoscaling = true
    location_policy    = "BALANCED"
    preemptible        = false
    spot               = false
    auto_repair        = true
    auto_upgrade       = true
    max_surge          = 2
    max_unavailable    = 0
    upgrade_strategy   = "SURGE"
    labels = {
      workload = "compute-intensive"
    }
    tags = ["gke-node", "compute"]
    taints = [
      {
        key    = "workload"
        value  = "compute"
        effect = "NO_SCHEDULE"
      }
    ]
    enable_secure_boot          = true
    enable_integrity_monitoring = true
    node_locations              = []
  },
  {
    name               = "spot"
    machine_type       = "e2-standard-4"
    disk_size_gb       = 100
    disk_type          = "pd-standard"
    image_type         = "COS_CONTAINERD"
    initial_node_count = 0
    min_count          = 0
    max_count          = 20
    enable_autoscaling = true
    location_policy    = "ANY"
    preemptible        = false
    spot               = true
    auto_repair        = true
    auto_upgrade       = true
    max_surge          = 3
    max_unavailable    = 0
    upgrade_strategy   = "SURGE"
    labels = {
      workload = "batch"
      "cloud.google.com/gke-spot" = "true"
    }
    tags = ["gke-node", "spot"]
    taints = [
      {
        key    = "cloud.google.com/gke-spot"
        value  = "true"
        effect = "NO_SCHEDULE"
      }
    ]
    enable_secure_boot          = true
    enable_integrity_monitoring = true
    node_locations              = []
  }
]

# GPU Node Pool Example (uncomment if needed)
# {
#   name               = "gpu"
#   machine_type       = "n1-standard-4"
#   disk_size_gb       = 200
#   disk_type          = "pd-ssd"
#   image_type         = "COS_CONTAINERD"
#   initial_node_count = 0
#   min_count          = 0
#   max_count          = 4
#   enable_autoscaling = true
#   preemptible        = false
#   spot               = false
#   accelerator_type   = "nvidia-tesla-t4"
#   accelerator_count  = 1
#   gpu_driver_version = "DEFAULT"
#   labels = {
#     workload = "gpu"
#   }
#   taints = [
#     {
#       key    = "nvidia.com/gpu"
#       value  = "present"
#       effect = "NO_SCHEDULE"
#     }
#   ]
# }

# -----------------------------------------------------------------------------
# Security Configuration
# -----------------------------------------------------------------------------

enable_binary_authorization = false
security_posture_mode       = "BASIC"
vulnerability_mode          = "VULNERABILITY_BASIC"

# -----------------------------------------------------------------------------
# DNS Configuration
# -----------------------------------------------------------------------------

cluster_dns        = "CLOUD_DNS"
cluster_dns_scope  = "CLUSTER_SCOPE"
cluster_dns_domain = ""

# -----------------------------------------------------------------------------
# Maintenance Window
# -----------------------------------------------------------------------------

maintenance_window = {
  start_time = "03:00"  # 3 AM UTC
}

# -----------------------------------------------------------------------------
# Default SNAT
# -----------------------------------------------------------------------------

disable_default_snat = false

# -----------------------------------------------------------------------------
# Container Registry (Legacy - not recommended)
# -----------------------------------------------------------------------------

enable_container_registry   = false
container_registry_location = "US"

# -----------------------------------------------------------------------------
# Artifact Registry
# -----------------------------------------------------------------------------

enable_artifact_registry         = true
artifact_registry_cleanup_dry_run = false

artifact_registry_cleanup_policies = [
  {
    id     = "delete-untagged"
    action = "DELETE"
    condition = {
      tag_state  = "UNTAGGED"
      older_than = "2592000s"  # 30 days
    }
  },
  {
    id     = "keep-recent"
    action = "KEEP"
    most_recent_versions = {
      keep_count = 10
    }
  }
]

# -----------------------------------------------------------------------------
# Labels
# -----------------------------------------------------------------------------

labels = {
  team        = "platform"
  cost_center = "engineering"
  managed_by  = "terraform"
}
