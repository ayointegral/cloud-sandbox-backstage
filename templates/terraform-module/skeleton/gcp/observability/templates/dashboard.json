{
  "displayName": "${dashboard_display_name}",
  "labels": {
    "environment": "${environment}"
  },
  "mosaicLayout": {
    "columns": 12,
    "tiles": [
      {
        "height": 4,
        "width": 12,
        "widget": {
          "title": "Dashboard Overview - ${environment}",
          "text": {
            "content": "# ${dashboard_display_name}\n\nThis dashboard provides observability metrics for the **${environment}** environment in project **${project_id}**.\n\n- **CPU & Memory**: Resource utilization metrics\n- **Errors**: Application error rates and counts\n- **Latency**: Request latency distribution\n- **HTTP Status**: Response status code breakdown",
            "format": "MARKDOWN"
          }
        }
      },
      {
        "xPos": 0,
        "yPos": 4,
        "height": 4,
        "width": 6,
        "widget": {
          "title": "CPU Utilization",
          "xyChart": {
            "dataSets": [
              {
                "timeSeriesQuery": {
                  "timeSeriesFilter": {
                    "filter": "resource.type = \"gce_instance\" AND metric.type = \"compute.googleapis.com/instance/cpu/utilization\"",
                    "aggregation": {
                      "alignmentPeriod": "60s",
                      "perSeriesAligner": "ALIGN_MEAN",
                      "crossSeriesReducer": "REDUCE_MEAN",
                      "groupByFields": ["resource.label.instance_id"]
                    }
                  }
                },
                "plotType": "LINE",
                "legendTemplate": "$${resource.labels.instance_id}"
              }
            ],
            "yAxis": {
              "label": "CPU %",
              "scale": "LINEAR"
            },
            "chartOptions": {
              "mode": "COLOR"
            }
          }
        }
      },
      {
        "xPos": 6,
        "yPos": 4,
        "height": 4,
        "width": 6,
        "widget": {
          "title": "Memory Utilization",
          "xyChart": {
            "dataSets": [
              {
                "timeSeriesQuery": {
                  "timeSeriesFilter": {
                    "filter": "resource.type = \"gce_instance\" AND metric.type = \"agent.googleapis.com/memory/percent_used\" AND metric.labels.state = \"used\"",
                    "aggregation": {
                      "alignmentPeriod": "60s",
                      "perSeriesAligner": "ALIGN_MEAN",
                      "crossSeriesReducer": "REDUCE_MEAN",
                      "groupByFields": ["resource.label.instance_id"]
                    }
                  }
                },
                "plotType": "LINE",
                "legendTemplate": "$${resource.labels.instance_id}"
              }
            ],
            "yAxis": {
              "label": "Memory %",
              "scale": "LINEAR"
            },
            "chartOptions": {
              "mode": "COLOR"
            }
          }
        }
      },
      {
        "xPos": 0,
        "yPos": 8,
        "height": 4,
        "width": 4,
        "widget": {
          "title": "Error Count",
          "xyChart": {
            "dataSets": [
              {
                "timeSeriesQuery": {
                  "timeSeriesFilter": {
                    "filter": "resource.type = \"global\" AND metric.type = \"logging.googleapis.com/user/${error_metric_name}\"",
                    "aggregation": {
                      "alignmentPeriod": "60s",
                      "perSeriesAligner": "ALIGN_RATE",
                      "crossSeriesReducer": "REDUCE_SUM"
                    }
                  }
                },
                "plotType": "STACKED_BAR",
                "legendTemplate": "Errors/min"
              }
            ],
            "yAxis": {
              "label": "Count",
              "scale": "LINEAR"
            },
            "chartOptions": {
              "mode": "COLOR"
            }
          }
        }
      },
      {
        "xPos": 4,
        "yPos": 8,
        "height": 4,
        "width": 4,
        "widget": {
          "title": "Request Latency (p50, p95, p99)",
          "xyChart": {
            "dataSets": [
              {
                "timeSeriesQuery": {
                  "timeSeriesFilter": {
                    "filter": "resource.type = \"global\" AND metric.type = \"logging.googleapis.com/user/${latency_metric_name}\"",
                    "aggregation": {
                      "alignmentPeriod": "60s",
                      "perSeriesAligner": "ALIGN_PERCENTILE_50"
                    }
                  }
                },
                "plotType": "LINE",
                "legendTemplate": "p50"
              },
              {
                "timeSeriesQuery": {
                  "timeSeriesFilter": {
                    "filter": "resource.type = \"global\" AND metric.type = \"logging.googleapis.com/user/${latency_metric_name}\"",
                    "aggregation": {
                      "alignmentPeriod": "60s",
                      "perSeriesAligner": "ALIGN_PERCENTILE_95"
                    }
                  }
                },
                "plotType": "LINE",
                "legendTemplate": "p95"
              },
              {
                "timeSeriesQuery": {
                  "timeSeriesFilter": {
                    "filter": "resource.type = \"global\" AND metric.type = \"logging.googleapis.com/user/${latency_metric_name}\"",
                    "aggregation": {
                      "alignmentPeriod": "60s",
                      "perSeriesAligner": "ALIGN_PERCENTILE_99"
                    }
                  }
                },
                "plotType": "LINE",
                "legendTemplate": "p99"
              }
            ],
            "yAxis": {
              "label": "Latency (s)",
              "scale": "LINEAR"
            },
            "chartOptions": {
              "mode": "COLOR"
            }
          }
        }
      },
      {
        "xPos": 8,
        "yPos": 8,
        "height": 4,
        "width": 4,
        "widget": {
          "title": "HTTP Status Codes",
          "xyChart": {
            "dataSets": [
              {
                "timeSeriesQuery": {
                  "timeSeriesFilter": {
                    "filter": "resource.type = \"global\" AND metric.type = \"logging.googleapis.com/user/${status_metric_name}\"",
                    "aggregation": {
                      "alignmentPeriod": "60s",
                      "perSeriesAligner": "ALIGN_RATE",
                      "crossSeriesReducer": "REDUCE_SUM",
                      "groupByFields": ["metric.labels.status_code"]
                    }
                  }
                },
                "plotType": "STACKED_BAR",
                "legendTemplate": "$${metric.labels.status_code}"
              }
            ],
            "yAxis": {
              "label": "Requests/min",
              "scale": "LINEAR"
            },
            "chartOptions": {
              "mode": "COLOR"
            }
          }
        }
      },
      {
        "xPos": 0,
        "yPos": 12,
        "height": 4,
        "width": 6,
        "widget": {
          "title": "Error Rate by Severity",
          "pieChart": {
            "dataSets": [
              {
                "timeSeriesQuery": {
                  "timeSeriesFilter": {
                    "filter": "resource.type = \"global\" AND metric.type = \"logging.googleapis.com/user/${error_metric_name}\"",
                    "aggregation": {
                      "alignmentPeriod": "3600s",
                      "perSeriesAligner": "ALIGN_SUM",
                      "crossSeriesReducer": "REDUCE_SUM",
                      "groupByFields": ["metric.labels.severity"]
                    }
                  }
                }
              }
            ],
            "chartType": "DONUT"
          }
        }
      },
      {
        "xPos": 6,
        "yPos": 12,
        "height": 4,
        "width": 6,
        "widget": {
          "title": "Network Traffic",
          "xyChart": {
            "dataSets": [
              {
                "timeSeriesQuery": {
                  "timeSeriesFilter": {
                    "filter": "resource.type = \"gce_instance\" AND metric.type = \"compute.googleapis.com/instance/network/received_bytes_count\"",
                    "aggregation": {
                      "alignmentPeriod": "60s",
                      "perSeriesAligner": "ALIGN_RATE",
                      "crossSeriesReducer": "REDUCE_SUM"
                    }
                  }
                },
                "plotType": "LINE",
                "legendTemplate": "Received"
              },
              {
                "timeSeriesQuery": {
                  "timeSeriesFilter": {
                    "filter": "resource.type = \"gce_instance\" AND metric.type = \"compute.googleapis.com/instance/network/sent_bytes_count\"",
                    "aggregation": {
                      "alignmentPeriod": "60s",
                      "perSeriesAligner": "ALIGN_RATE",
                      "crossSeriesReducer": "REDUCE_SUM"
                    }
                  }
                },
                "plotType": "LINE",
                "legendTemplate": "Sent"
              }
            ],
            "yAxis": {
              "label": "Bytes/s",
              "scale": "LINEAR"
            },
            "chartOptions": {
              "mode": "COLOR"
            }
          }
        }
      },
      {
        "xPos": 0,
        "yPos": 16,
        "height": 4,
        "width": 4,
        "widget": {
          "title": "Current Error Count",
          "scorecard": {
            "timeSeriesQuery": {
              "timeSeriesFilter": {
                "filter": "resource.type = \"global\" AND metric.type = \"logging.googleapis.com/user/${error_metric_name}\"",
                "aggregation": {
                  "alignmentPeriod": "300s",
                  "perSeriesAligner": "ALIGN_SUM",
                  "crossSeriesReducer": "REDUCE_SUM"
                }
              }
            },
            "thresholds": [
              {
                "value": 10,
                "color": "YELLOW",
                "direction": "ABOVE"
              },
              {
                "value": 50,
                "color": "RED",
                "direction": "ABOVE"
              }
            ]
          }
        }
      },
      {
        "xPos": 4,
        "yPos": 16,
        "height": 4,
        "width": 4,
        "widget": {
          "title": "Avg CPU Utilization",
          "scorecard": {
            "timeSeriesQuery": {
              "timeSeriesFilter": {
                "filter": "resource.type = \"gce_instance\" AND metric.type = \"compute.googleapis.com/instance/cpu/utilization\"",
                "aggregation": {
                  "alignmentPeriod": "300s",
                  "perSeriesAligner": "ALIGN_MEAN",
                  "crossSeriesReducer": "REDUCE_MEAN"
                }
              }
            },
            "thresholds": [
              {
                "value": 0.7,
                "color": "YELLOW",
                "direction": "ABOVE"
              },
              {
                "value": 0.9,
                "color": "RED",
                "direction": "ABOVE"
              }
            ]
          }
        }
      },
      {
        "xPos": 8,
        "yPos": 16,
        "height": 4,
        "width": 4,
        "widget": {
          "title": "Avg Memory Utilization",
          "scorecard": {
            "timeSeriesQuery": {
              "timeSeriesFilter": {
                "filter": "resource.type = \"gce_instance\" AND metric.type = \"agent.googleapis.com/memory/percent_used\" AND metric.labels.state = \"used\"",
                "aggregation": {
                  "alignmentPeriod": "300s",
                  "perSeriesAligner": "ALIGN_MEAN",
                  "crossSeriesReducer": "REDUCE_MEAN"
                }
              }
            },
            "thresholds": [
              {
                "value": 70,
                "color": "YELLOW",
                "direction": "ABOVE"
              },
              {
                "value": 90,
                "color": "RED",
                "direction": "ABOVE"
              }
            ]
          }
        }
      },
      {
        "xPos": 0,
        "yPos": 20,
        "height": 4,
        "width": 12,
        "widget": {
          "title": "Recent Logs",
          "logsPanel": {
            "filter": "severity >= WARNING",
            "resourceNames": ["projects/${project_id}"]
          }
        }
      }
    ]
  }
}
