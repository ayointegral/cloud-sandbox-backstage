# =============================================================================
# AWX Operator Components for Cloud Sandbox Backstage
# =============================================================================
# AWX Operator is an open source project - https://github.com/ansible/awx-operator
# The github.com/project-slug annotations point to the official AWX Operator repository
#
# To enable TechDocs for a component, add:
#   annotations:
    backstage.io/techdocs-ref: dir:.
#   (requires mkdocs.yml in the repo root)
# =============================================================================

apiVersion: backstage.io/v1alpha1
kind: Component
metadata:
  name: awx-operator
  title: AWX Operator
  description: Kubernetes operator for deploying and managing AWX instances
  annotations:
    github.com/project-slug: ansible/awx-operator
    backstage.io/techdocs-ref: dir:.
    # sonarqube.org/project-key: awx-operator
    # jenkins.io/job-full-name: awx-operator/awx-operator-ci
  tags:
    - kubernetes
    - operator
    - deployment
    - ansible
    - automation
  links:
    - url: https://github.com/ansible/awx-operator
      title: Source Code
      icon: github
    - url: https://ansible.readthedocs.io/projects/awx-operator/en/latest/
      title: Documentation
      icon: docs
spec:
  type: library
  lifecycle: production
  owner: platform-team
  system: kubernetes-operators
  dependsOn:
    - resource:kubernetes-cluster
  consumesApis:
    - kubernetes-api
  providesApis:
    - awx-operator-api
---
apiVersion: backstage.io/v1alpha1
kind: API
metadata:
  name: awx-operator-api
  title: AWX Operator API
  description: Custom Resource Definitions for AWX operator
  annotations:
    github.com/project-slug: ansible/awx-operator
  tags:
    - kubernetes
    - crd
    - operator
spec:
  type: openapi
  lifecycle: production
  owner: platform-team
  system: kubernetes-operators
  definition: |
    openapi: 3.0.0
    info:
      title: AWX Operator API
      version: '2.8.0'
      description: Custom Resource Definitions for AWX operator
    components:
      schemas:
        AWX:
          type: object
          properties:
            apiVersion:
              type: string
              enum: [awx.ansible.com/v1beta1]
            kind:
              type: string
              enum: [AWX]
            metadata:
              type: object
              properties:
                name:
                  type: string
                namespace:
                  type: string
            spec:
              type: object
              properties:
                service_type:
                  type: string
                  enum: [ClusterIP, NodePort, LoadBalancer]
                ingress_type:
                  type: string
                  enum: [none, Ingress, Route]
                hostname:
                  type: string
                admin_user:
                  type: string
                admin_password_secret:
                  type: string
                postgres_configuration_secret:
                  type: string
                old_postgres_configuration_secret:
                  type: string
---
apiVersion: backstage.io/v1alpha1
kind: API
metadata:
  name: kubernetes-api
  title: Kubernetes API
  description: Standard Kubernetes API
  tags:
    - kubernetes
    - api
spec:
  type: openapi
  lifecycle: production
  owner: platform-team
  system: kubernetes-operators
  definition: |
    openapi: 3.0.0
    info:
      title: Kubernetes API
      version: '1.28.0'
      description: Standard Kubernetes API for cluster management
    paths:
      /api/v1/namespaces:
        get:
          summary: List namespaces
          responses:
            '200':
              description: Namespace list
      /api/v1/namespaces/{namespace}/pods:
        get:
          summary: List pods in namespace
          parameters:
            - name: namespace
              in: path
              required: true
              schema:
                type: string
          responses:
            '200':
              description: Pod list
      /apis/apps/v1/namespaces/{namespace}/deployments:
        get:
          summary: List deployments in namespace
          parameters:
            - name: namespace
              in: path
              required: true
              schema:
                type: string
          responses:
            '200':
              description: Deployment list
---
apiVersion: backstage.io/v1alpha1
kind: Resource
metadata:
  name: kubernetes-cluster
  title: Kubernetes Cluster
  description: Kubernetes cluster for running AWX operator and instances
  tags:
    - kubernetes
    - infrastructure
    - cluster
spec:
  type: cluster
  owner: platform-team
  system: kubernetes-operators
---
apiVersion: backstage.io/v1alpha1
kind: Component
metadata:
  name: awx-helm-chart
  title: AWX Helm Chart
  description: Helm chart for deploying AWX operator
  annotations:
    github.com/project-slug: ansible/awx-operator
    # backstage.io/techdocs-ref: dir:.
  tags:
    - helm
    - kubernetes
    - deployment
    - chart
spec:
  type: library
  lifecycle: production
  owner: platform-team
  system: kubernetes-operators
  dependsOn:
    - component:awx-operator
